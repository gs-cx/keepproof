// 1. Configuration du client avec extensions
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"] 
}

// 2. Connexion BDD et activation de pgvector
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [vector]
}

model User {
  id        String   @id // Clerk ID
  email     String   @unique
  credits   Int      @default(3)
  createdAt DateTime @default(now())
  proofs    Proof[]
  auditLogs AuditLog[]
}

model Proof {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  filename    String
  fileHash    String   // SHA-256 (IntÃ©gritÃ© stricte)
  fileSize    Int
  mimeType    String
  storagePath String?
  
  // ðŸ‘‡ C'EST ICI : Le vecteur pour l'IA (384 dimensions)
  vector      Unsupported("vector(384)")? 

  status      String   @default("PROTECTED") 
  txHash      String?  
  tags        String[]
  
  createdAt   DateTime @default(now())
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  action    String   
  status    String   
  details   String?
  createdAt DateTime @default(now())
}
